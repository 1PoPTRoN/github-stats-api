<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>GitHub Repo Explorer</title>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        :root {
            --bg-page: #0d1117;
            --bg-card: #161b22;
            --border-subtle: #30363d;
            --text-main: #c9d1d9;
            --text-muted: #8b949e;
            --accent: #238636;
            --accent-soft: #1e8640;
            --error: #f85149;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            padding: 24px;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background: var(--bg-page);
            color: var(--text-main);
            display: flex;
            justify-content: center;
        }

        .page {
            width: 100%;
            max-width: 820px;
        }

        .card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 8px;
            padding: 18px 20px 20px;
        }

        .header-title {
            font-size: 20px;
            font-weight: 600;
            margin: 0 0 4px 0;
        }

        .header-sub {
            margin: 0 0 16px 0;
            font-size: 13px;
            color: var(--text-muted);
        }

        .input-row {
            display: flex;
            gap: 8px;
            margin-bottom: 6px;
        }

        .input-row input {
            flex: 1;
            padding: 8px 10px;
            border-radius: 6px;
            border: 1px solid var(--border-subtle);
            background: #010409;
            color: var(--text-main);
            font-size: 14px;
        }

        .input-row input:focus {
            outline: 1px solid #58a6ff;
            border-color: #58a6ff;
        }

        .btn {
            padding: 8px 14px;
            border-radius: 6px;
            border: 1px solid rgba(240, 246, 252, 0.1);
            background: var(--accent);
            color: white;
            font-size: 14px;
            cursor: pointer;
            white-space: nowrap;
        }

        .btn:hover {
            background: var(--accent-soft);
        }

        .helper-text {
            font-size: 12px;
            color: var(--text-muted);
            margin-bottom: 8px;
        }

        #errorBox {
            color: var(--error);
            font-size: 13px;
            margin-top: 4px;
            min-height: 16px;
        }

        #repoResult {
            margin-top: 16px;
            border-top: 1px solid var(--border-subtle);
            padding-top: 14px;
            font-size: 14px;
        }

        #repoResult h3 {
            margin: 0 0 4px 0;
            font-size: 16px;
        }

        #repoResult a {
            color: #58a6ff;
            text-decoration: none;
        }

        #repoResult a:hover {
            text-decoration: underline;
        }

        #repoResult p {
            margin: 0 0 6px 0;
            color: var(--text-muted);
            font-size: 13px;
        }

        #repoResult ul {
            list-style: none;
            padding-left: 0;
            margin: 6px 0 0 0;
        }

        #repoResult li {
            margin-bottom: 2px;
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
            font-size: 13px;
        }

        .chart-wrapper {
            margin-top: 20px;
            border: 1px solid var(--border-subtle);
            border-radius: 8px;
            padding: 10px 12px 12px;
            background: #0b1016;
        }

        .chart-title {
            font-size: 13px;
            color: var(--text-muted);
            margin-bottom: 6px;
        }

        canvas {
            max-width: 100%;
        }

        .loading {
            font-size: 13px;
            color: var(--text-muted);
        }
    </style>
</head>

<body>
<div class="page">
    <div class="card">
        <h1 class="header-title">GitHub Repository Explorer</h1>
        <p class="header-sub">
            Check basic statistics of any public GitHub repository.
        </p>

        <div class="input-row">
            <input
                id="repoInput"
                type="text"
                placeholder="owner/repo or full GitHub URL"
            />
            <button class="btn" onclick="fetchRepo()">Analyze</button>
        </div>

        <div class="helper-text">
            Example: <code style="font-family: monospace;">torvalds/linux</code>
        </div>

        <div id="errorBox"></div>
        <div id="repoResult"></div>

        <div class="chart-wrapper">
            <div class="chart-title">Repository statistics (stars, forks, watchers, open issues)</div>
            <canvas id="repoChart" height="140"></canvas>
        </div>
    </div>
</div>

<script>
    let repoChart = null;

    async function fetchRepo() {
        const input = document.getElementById("repoInput");
        const repo = input.value.trim();
        const errorBox = document.getElementById("errorBox");
        const repoResult = document.getElementById("repoResult");

        errorBox.textContent = "";
        repoResult.innerHTML = "";

        if (!repo) {
            errorBox.textContent = "Please enter a repository name or URL.";
            return;
        }

        repoResult.innerHTML = '<div class="loading">Loading repository data‚Ä¶</div>';

        try {
            const response = await fetch(`/api/repo-stats?repo=${encodeURIComponent(repo)}`);
            const data = await response.json();

            if (!response.ok) {
                throw new Error(data.detail || "Something went wrong");
            }

            const pushed = data.pushed_at || "N/A";
            const updated = data.updated_at || "N/A";

            repoResult.innerHTML = `
                <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 10px;">
                    <img 
                        src="${data.owner?.avatar_url}" 
                        alt="avatar"
                        style="width: 60px; height: 60px; border-radius: 50%; border: 1px solid #30363d;"
                    >
                    <div>
                        <h3 style="margin:0; font-size:16px;">
                            <a href="${data.html_url}" target="_blank" rel="noopener noreferrer">
                                ${data.full_name}
                            </a>
                        </h3>
                        <div style="color:#8b949e; font-size:13px; margin-top:2px;">
                            by ${data.owner?.login}
                        </div>
                    </div>
                </div>

                <p style="margin: 0 0 6px 0;">${data.description || "No description available."}</p>

                <ul>
                    <li>‚≠ê Stars: ${data.stars}</li>
                    <li>üç¥ Forks: ${data.forks}</li>
                    <li>üëÄ Watchers: ${data.watchers}</li>
                    <li>üêõ Open issues: ${data.open_issues}</li>
                    <li>‚è≥ Last push: ${pushed}</li>
                    <li>üîÑ Updated: ${updated}</li>
                </ul>
            `;

            const ctx = document.getElementById("repoChart").getContext("2d");

            if (repoChart) {
                repoChart.destroy();
            }

            repoChart = new Chart(ctx, {
                type: "bar",
                data: {
                    labels: ["Stars", "Forks", "Watchers", "Open Issues"],
                    datasets: [{
                        label: "Count",
                        data: [
                            data.stars || 0,
                            data.forks || 0,
                            data.watchers || 0,
                            data.open_issues || 0
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        x: {
                            grid: { display: false }
                        },
                        y: {
                            beginAtZero: true,
                            grid: { color: "rgba(240, 246, 252, 0.1)" },
                            ticks: { precision: 0 }
                        }
                    }
                }
            });

        } catch (err) {
            repoResult.innerHTML = "";
            errorBox.textContent = err.message;
        }
    }

    document.getElementById("repoInput").addEventListener("keydown", function (e) {
        if (e.key === "Enter") {
            fetchRepo();
        }
    });
</script>
</body>
</html>